// Generated by CoffeeScript 1.9.3
(function() {
  var controller, db, express;

  express = require('express');

  controller = express.Router();

  db = require('../models/DB');

  controller.get('/stocklist', function(req, res) {
    var collection;
    collection = db.get('stocklist');
    return collection.find({}, {
      sort: {
        stockname: 1
      }
    }, function(err, stocklist) {
      return res.render('stocklist', {
        title: 'Stock List',
        'stocklist': stocklist
      });
    });
  });

  controller.post('/addstock', function(req, res) {
    var collection, stock;
    stock = req.body;
    stock.stockname = stock.stockname.toUpperCase();
    collection = db.get('stocklist');
    collection.count({
      'stockname': stock.stockname
    }).then(function(count) {
      if (count === 0) {
        if (!stock.number) {
          stock.number = 0;
        }
        if (!stock.acb) {
          stock.acb = 0;
        }
        return collection.insert(stock);
      }
    });
    return res.redirect('stocklist');
  });

  controller.post('/deletestock', function(req, res) {
    var collection, stockname;
    stockname = req.body.stockname;
    collection = db.get('stocklist');
    return collection.remove({
      stockname: stockname
    }, function(err) {
      if (err) {
        res.send('There was a problem deleting the information to the database.');
      }
      return res.redirect('stocklist');
    });
  });

  module.exports = controller;

}).call(this);
